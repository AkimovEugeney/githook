#!/bin/bash

# Получаем сообщение коммита
MESSAGE=$(cat "$1")
# Проверяем формат сообщения с использованием регулярного выражения
if ! [[ "$MESSAGE" =~ ^(Задача\ №\ [0-9]+\ -\ )?(feat|fix|chore|docs|refactor|test|ci|perf):\ .{3,}$ ]]; then
  echo "❌ Ошибка: сообщение коммита должно соответствовать формату:"
  echo "Задача № <номер задачи> - <тип коммита>(<модуль>): <описание>"
  echo "Или без задачи: <тип коммита>: <описание>"
  exit 1  # Прерываем выполнение, если сообщение не соответствует формату
fi

echo "✅ Сообщение коммита прошло проверку!"

test "" = "$(grep '^Signed-off-by: ' "$1" |
	 sort | uniq -c | sed -e '/^[ 	]*1[ 	]/d')" || {
	echo >&2 Duplicate Signed-off-by lines.
	exit 1
}